[![CodeFactor](https://www.codefactor.io/repository/github/tig/winprint/badge?s=93affda0738af869187afe5296914b814511f529)](https://www.codefactor.io/repository/github/tig/winprint)

# WinPrint 2.0

WinPrint - A modern take on the the classic source code printing app from [1988](https://www.kindel.com/products/winprint/).

WinPrint is the perfect tool for printing source code, web pages, reports generated by legacy systems, documentation, or any text file. It works either interactively or from the command line making it perfect for single users or whole enterprises.

![WinPrint 2.0](https://i.imgur.com/rg2U5pc.png)

## Install

No public releases yet (because I'm embarrased by a few bugs and performance issues; see Issues). Feel free to clone and build for now. I use VS 2016 Preview 2. 

## History

Ever since I started programming on an Apple ][+ in 1981, I've had a thing for printing. My earliest apps focused on printing and my first money-making endeavor was "Tapes", which printed casette tape '[J-cards](https://en.wikipedia.org/wiki/J-card)' for all the mix-tapes of great '80s music me made for the girls. Whenever I learned a new programming language or OS, the first app I'd write was '[Spit](https://github.com/tig/Tigger/blob/a2013af12fef6d9946adea7fe510f8c649766160/College/C_SRC/SPIT153.C)', an app for printing my source code all pretty (it "spits" source code out of a printer). Over the years, I wrote Spit for AppleDOS (Apple BASIC), UCSD-Pascal, CP/M (Turbo Pascal), DOS (8086 assembly and C), VAX/VMS (Pascal and FORTRAN-77, and Mac (Pascal).

In 1988, as a College Senior, I decided Windows was going to win (over OS/2) I was going to work for Microsoft. I bought Charles Petzold's "Programming Windows" and conned my dad into buying me a copy of the Windows 2.0 SDK (which was like $300 back then!). On my amazeballs ALR 386/33 PC I set about becoming a Windows programmer. The first (useful) app I wrote was WinSpit. In a rare moment of adulting, I renamed it [WinPrint and listed it on CompuServe](http://www.kindel.com/products/winprint/) as shareware ($25). For the next 10 years those $25 checks just arrived in the mail. Even better, WinPrint demonstrated to Microsoft I could actually, really write code. So they hired me.

Several times in the early 1990s I started writing WinPrint 2.0. Each time I had the basics working and realized three things: 1) Nobody cares about printing source code, 3) I'd over-engineered things, and 2) the technology I choose was already dated (e.g. MFC). Two of those abandoned efforts can be found in my archive [here (1992)](https://github.com/tig/Tigger/tree/master/Shareware/WINPRT2/WINPRINT) and [here (1994)](https://github.com/tig/Tigger/tree/master/Shareware/WINPRT2/WINPRT20).

Last year (2019) I got a wild-hair to write some code as a way of blowing off steam, and proving to myself I was still cool. It all started with MS releasing the [Cascadia Code](https://devblogs.microsoft.com/commandline/cascadia-code/) font. I have a thing for fixed-pitch fonts. It's weird. Anyway, I installed the font in Terminal and VScode but just looking at stuff wasn't enough. I needed to *use the font in anger*!. So I fixed some long-standing issues in [MCE Controller](https://tig.github.io/mcec/) (another app I wrote that nobody uses anymore).

This all led to me accidentally finding the old WinPrint 2.0 source code. Reminiscing on how much time I wasted back then, I just had to try again. So I did. And, just to be clear, here's what I did:

1) I wrote a *printing* app in 2019-2020. Nobody prints these days. *I* don't even print anymore. 
2) I over-engineered it. It has a full GUI with print preview. Headers and Footers with *Macros*. A full command-line interface. It can syntax-highlight over 200 different programming languages. It's cross-platfom. And more.
3) I used .NET and C#. Ok, this part I can defend (assuming you get past point #1 and #2): First, I know C# well and it is awesome. Second, no other modern language/app-framework can even SPELL "print". I tried both Electron and Flutter and both suck when it comes to printing.

So, there you are. I present to you WinPrint 2.0. I hope you enjoy it.

## Features

* Cross platform. Even though it's named **Win**Print, it works on Windows, Linux (command line only), and (not yet tested) Mac OS.
* Use from the Command Line/Console or GUI.
* Print source code with syntax highlighting and line numbering for over 200 programming langauges and file formats.
* Print "multiple-pages-up" on one piece of paper (saves trees!)
* Complete control over all page formatting options, including headers and footers, margins, fonts, page orientation, etc...
* Simple and elegant graphical user interface with accurate print preview.
* Complete command line interface. Allows WinPrint to be used from other applications or solutions.
* Sheet Definitions make it easy to save settings for frequent print jobs.
* Headers and Footers support detailed file nad print information macros with rich date/time formatting.

## Installing

**On Windows**: Download and run the setup file. Once installed, WinPrint can be started from the Start menu or command line. The installer adds WinPrint to the `PATH` so that typing `winprint` from any command prompt will run the app.

**On Linux**: Good luck. Start by cloning the WinPrint repo, installing .NET Core 3, and buildng. Then I have some C++ libraries I'm using under the covers that you'll have to grab and build too. You'll need JUST THE RIGHT version of `libgdiplus`. It might help if you re-compile your kernel. You know, all the stuff reqruied to make anything work on one of several Linux distros. Did I mention how much [I hate linux](https://ceklog.kindel.com/2011/10/21/i-sincerely-tried-but-i-still-hate-linux/)? (Seriously, it does work on Linux. But until someone begs me for it, I'm not spending another second on trying to build an installer. Submit an Issue if you really want help.)

**On Mac**: I haven't even tried as my old Macbook Air died and Apple wont fix it. I refuse to buy anything from Apple (except for for my family who are all all-in with Apple...sigh). I'll buy beer for someone who contributes to getting the Mac version working. It should not be hard given I've proven the stupid things works on Linux already.

## Command Line Interface

Examples:

Print Program.cs in landscape mode:

    winprint --landscape Program.cs

Print all .cs files on a specific printer with a specific paper size:

    winprint --printer "Fabricam 535" --paper-size A4 *.cs

Print the first two pages of Program.cs:

    winprint --from-sheet 1 --to-sheet 2 Program.cs

Print Program.cs using the 2 Up sheet defintion:

    winprint --sheet "2 Up" Program.cs

* `-s`, `--sheet` - Sheet defintion to use for formatting. Use sheet ID or friendly name.

* `-l`, `--landscape` - Force landscape orientation.

* `-r`, `--portrait` - Force portrait orientation.

* `-p`, `--printer` - Printer name.

* `-z`, `--paper-size` - Paper size name.

* `-f`, `--from-sheet` - (Default: 0) Number of first sheet to print (may be used with `--to-sheet`).

* `-t`, `--to-sheet` - (Default: 0) Number of last sheet to print (may be used with `--from-sheet`).

* `-c`, `--count-sheet` - (Default: false) Exit code is set to numer of sheet that would be printed. Use `--verbose` to diplsay the count.

* `-e`, `--content-type-engine` - Name of the Content Type Engine to use for rendering (`text/plain`, `text/html`, or `<language>`).

* `-v`, `--verbose` - (Default: false) Verbose console output (log is always verbose).

* `-d`, `--debug` - (Default: false) Debug-level console & log output.

* `-g`, `--gui` - (Default: false) Show WinPrint GUI (to preview or change sheet settings).

* `--help` - Display this help screen.

* `--version` - Display version information.

* `<files>` - Required. One or more files to be printed.

## Graphical User Interface

When run as a Windows app (`winprintgui.exe`), WinPrint provides an easy to use GUI for previewing how a file will be printed and changing many settings.

The **File button** opens a File Open Dialog for choosing the file to preview and/or print. The GUI app can print a single file at a time. Use the console verion (`winprint.exe`) to print multiple files at once.

The **Print button** prints the currently selected file.

The **Settings (âš™) button** will open `WinPrint.Config.json` in your favorite text editor. Changes made to the file will be reflected in the GUI automatically.

## Sheet Definitions

Font choices, header/footer options, and other print-job settings are defined in WinPrint as *Sheet Definitions*. In the WinPrint world a **Sheet** is a side of a sheet of paper. Depending on how its configured, WinPrint will print one or more (even numbers) of **Pages** on each **Sheet**.

This is called "n-up" printing. The most common form of "n-up" printing is "2-up" where the page orientation is set to landscape and there are two columns of pages.

The layout and format of the **Sheet** is defined by a set of configuration settings called a **Sheet Definition**. Out of the box WinPrint comes with two: `Default 1 Up` and `Default 2 Up`.

**Sheet Definitions** are defined and stored in the `WinPrint.Config.json` configuration file found in `%appdata%\Kindel Systems\WinPrint`.

### Headers & Footers Macros

The format for header & footer specifiers is:

    <left part>|<center part>|<right part>

where `<left part>`,`<center part>`, and `<right part>` can be composed of text and any of the **Macros** described below. For example:

    {DateRevised:D}|{FullyQualifiedPath}|{FileType}

* `{NumPages}` - The total number of **Sheets** in the file.

* `{Page}` - The current **Sheet** number.

* `{FileExtension}` - The file extension of the file.

* `{FileName}` - The name of file without the extension.

* `{FilePath}` - The path to the file without the filename or extension.

* `{FullyQualifiedPath}` - The full path to the file, inclidng the filename and extension.

* `{FileType}` - The file type (for `text/plain` and `text/html`) or language (for `sourcecode`) of the file. 

* `{DatePrinted}` - The current date & time (see formatting below).

* `{DateRevised}` - The date & time the file was last revised.

The `{DatePrinted}` and `{DateRevised}` macros support the full set of [standard .NET date and time formatting modifiers](https://docs.microsoft.com/en-us/dotnet/standard/base-types/standard-date-and-time-format-strings). For example `{DateRevised:M}` will generate just the month and date (e.g. `September 10`) while `{DateRevised:t}` will generate just the `short time` (`4:55 PM`).

### Modifying Sheet Definitions

The WinPrint GUI can be used to change most Sheet Definition settings. All settings can be changed by editing the `WinPrint.Config.json` file. Note if `WinPrint.Config.json` is changed while the WinPrint GUI App is running, it will detect the change and re-flow the currently loaded file. In other-words, a text editor can be used as the UI for advanced settings.

### Creating new Sheet Definitions

WinPrint starts with two "built-in" Sheet Definitions: `Default 1-Up` and `Default 2-Up`. Additional Sheet Definitions can be created by editing `WinPrint.Config.json`, copying one of the existing Sheet Defintions and giving it a new unique `name` and unique `ID`.

## Content Types

WinPrint supports three rendering engines, representing three Content Types:

1. **`text/plain`** - This rendering engine knows only how to print raw `text/plain` files. The format of the printed text can be changed (e.g. to turn off line numbers or use a differnt font). Lines that are too long for a page are wrapped at character boundaries. `\r` (formfeed) characters can be made to cause following text to print on the next page (this is off by default). Settings for the `text/plain` can be changed by editing the `textFileSettings` section of a Sheet Definition in the `WinPrint.Config.json` file. 

2. **`text/html`** - This rendering engine can print html files. Any CSS specified by the HTML file will be honored. For HTML without CSS, the default CSS used can be overridden by providing a file named `winprint.css` in the `%appdata%\Kindel Systems\WinPrint` folder. `text/html` does not support line numbers.

3. **`text/sourcecode`** - The sourcecode rendering engine supports syntax highlighting (pretty printing), with optional line numbering, of over 200 programming languages. The style of the printing can be changed by providing a file named `winprint-prism.css` in the `%appdata%\Kindel Systems\WinPrint` folder. The styles defined in this format shold match those defined for [PrismJS](https://prismjs.com). Any PrismJS style sheet will work with WinPrint.

The extension of the file being printed (e.g. `.cs`) is determines which Content Type rendering engine will be used. WinPrint has a built-in library of hundreds of file extension to content type/language mappings.

To associate a file extension with a particular Content Type Engine modify the `files.associations` section of `WinPrint.Config.json` appropriately. For example to associate files with a `.htm` extension with the `text/html` Content Type Engine add a line as shown below (the `WinPrint.Config.json` generated when WinPrint runs the first time already provides this example, as an example):

    "files.associations": {
      "*.htm": "text/html",
    }

For associating file extentions with a particular programming language using the `sourcecode` File Type Renderer see below.

The commandline option `e`/`--content-type-engine` overrides content type and language detection.

## Language Associations

WinPrint's `text/sourcecode` File Type Engine knows how to syntax highlight (pretty print) over 200 programming languages. It has a built-in file extension to language mapping that should work for most modern scenarios. For example it knows that `.cs` files hold `C#` and `.bf` files hold `brainfuck`.

### Adding or Changing `text/sourcecode` Language Associations

To associate a file extension with a language spported by `text/sourcecode` modify the `files.associations` and `languages` sections of `WinPrint.Config.json` appropriately. For example to associate files with a `.config` extension with the JSON langauge  add a line as shown below (the `WinPrint.Config.json` generated when WinPrint runs the first time already provides this example, as an example):

    "files.associations": {
      "*.config": "json"
    }

To determine the name to use (e.g. `json`) see the [PrismJS](https://prismjs.com/#supported-languages) list of languages.

A new langauge can be defined by aliasing it to an existing language by modifying the `languages` section of `WinPrint.Config.json`. 

For example to enable the [Icon Programming Language](https://en.wikipedia.org/wiki/Icon_%28programming_language%29) which is a very C-like language the `files.associations` and `languages` sections would look like the following:

    "files.associations": {
      "*.icon": "icon"
    },
    "languages": [
      {
        "id": "icon",
        "extensions": [
          ".icon"
        ],
        "aliases": [
          "clike"
        ]
      }
    ]
