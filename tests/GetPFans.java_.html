<!DOCTYPE html><html><head><title>C:\Users\ckindel\source\winprint\tests\GetPFans.java</title>
<meta charset="utf-8"/>
<link href="file:///C:/Users/ckindel/source/node_modules/prismjs/themes/prism-coy.css" rel="stylesheet"/>
<link href="file:/C:/Users/ckindel/source/winprint/proto/winforms/WinPrint/bin/Debug/netcoreapp3.0/prism-winprint-overrides.css" rel="stylesheet"/>
</head><body>
<pre class="language-java line-numbers "><code class="language-csharp">

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token class-name">DigestSplitter</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;strong>GetPFans&lt;/strong> -- making a URL connection and
 * getting information from it.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetPFans</span> 
<span class="token punctuation">{</span> 

	<span class="token comment">/** Perform the process of binding to a URL
	 * @param urlString URL to bind to.
	 * @return Returns an input stream for the URL.
	 */</span>
	<span class="token keyword">static</span> <span class="token class-name">InputStream</span> <span class="token class-name">BindToURL</span><span class="token punctuation">(</span><span class="token class-name">String</span> urlString<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token class-name">URL</span> url<span class="token punctuation">;</span>
		<span class="token class-name">URLConnection</span> connection<span class="token punctuation">;</span>
		<span class="token keyword">int</span> contentLength<span class="token punctuation">;</span>
		<span class="token class-name">String</span> contentType<span class="token punctuation">;</span>
		<span class="token class-name">InputStream</span> inStream<span class="token punctuation">;</span>
		
		<span class="token comment">/* Create URL, make the connection, and get its input stream.
		 * NOTE:  methods for getting URLConnection information, such as
		 * getContentLength() and getContentType(), require a prior call to
		 * getInputStream(), even if you don't actually read from the stream.
		 */</span>
		<span class="token keyword">try</span> 
		<span class="token punctuation">{</span>
		    url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span><span class="token punctuation">;</span>
		    connection <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    inStream <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
		    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Exception:  "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
		    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Exception:  "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		
		<span class="token keyword">return</span> inStream<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token class-name">InputStream</span> inStream<span class="token punctuation">;</span>
		<span class="token class-name">String</span> list<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"911"</span><span class="token punctuation">,</span>
						<span class="token string">"General"</span><span class="token punctuation">,</span> 
						<span class="token string">"356"</span><span class="token punctuation">,</span>
						<span class="token string">"914"</span><span class="token punctuation">,</span>
						<span class="token string">"924-944"</span><span class="token punctuation">,</span>
						<span class="token string">"928"</span><span class="token punctuation">,</span>
						<span class="token string">"Boxster"</span><span class="token punctuation">,</span>
						<span class="token string">"Racing"</span><span class="token punctuation">,</span>
						<span class="token string">"Flamers"</span><span class="token punctuation">,</span>
						 <span class="token string">"Tavern"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> month<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"01"</span><span class="token punctuation">,</span> <span class="token string">"02"</span><span class="token punctuation">,</span> <span class="token string">"03"</span><span class="token punctuation">,</span> <span class="token string">"04"</span><span class="token punctuation">,</span> <span class="token string">"05"</span><span class="token punctuation">,</span> <span class="token string">"06"</span><span class="token punctuation">,</span> <span class="token string">"07"</span><span class="token punctuation">,</span> <span class="token string">"08"</span><span class="token punctuation">,</span> <span class="token string">"09"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"11"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> day<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"01"</span><span class="token punctuation">,</span> <span class="token string">"02"</span><span class="token punctuation">,</span> <span class="token string">"03"</span><span class="token punctuation">,</span> <span class="token string">"04"</span><span class="token punctuation">,</span> <span class="token string">"05"</span><span class="token punctuation">,</span> <span class="token string">"06"</span><span class="token punctuation">,</span> <span class="token string">"07"</span><span class="token punctuation">,</span> <span class="token string">"08"</span><span class="token punctuation">,</span> <span class="token string">"09"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">,</span> 
						<span class="token string">"11"</span><span class="token punctuation">,</span> <span class="token string">"12"</span><span class="token punctuation">,</span> <span class="token string">"13"</span><span class="token punctuation">,</span> <span class="token string">"14"</span><span class="token punctuation">,</span> <span class="token string">"15"</span><span class="token punctuation">,</span> <span class="token string">"16"</span><span class="token punctuation">,</span> <span class="token string">"17"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">,</span> <span class="token string">"19"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">,</span> 
						<span class="token string">"21"</span><span class="token punctuation">,</span> <span class="token string">"22"</span><span class="token punctuation">,</span> <span class="token string">"23"</span><span class="token punctuation">,</span> <span class="token string">"24"</span><span class="token punctuation">,</span> <span class="token string">"25"</span><span class="token punctuation">,</span> <span class="token string">"26"</span><span class="token punctuation">,</span> <span class="token string">"27"</span><span class="token punctuation">,</span> <span class="token string">"28"</span><span class="token punctuation">,</span> <span class="token string">"29"</span><span class="token punctuation">,</span> <span class="token string">"30"</span><span class="token punctuation">,</span> <span class="token string">"31"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> baseURL <span class="token operator">=</span> <span class="token string">"http://www.porschefans.com/Scripts/PorscheFansArchive.pl?PorscheFansArchive="</span><span class="token punctuation">;</span>
		
		<span class="token class-name">String</span> outRoot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token class-name">Calendar</span> rightNow <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> startYear <span class="token operator">=</span> <span class="token number">96</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> endYear <span class="token operator">=</span> rightNow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>rightNow<span class="token punctuation">.</span>YEAR<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1900</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> startDay <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> endDay <span class="token operator">=</span> rightNow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>rightNow<span class="token punctuation">.</span>DAY_OF_MONTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> startMonth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> endMonth <span class="token operator">=</span> rightNow<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>rightNow<span class="token punctuation">.</span>MONTH<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
		
		
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> a <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length <span class="token punctuation">;</span> a<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token class-name">StringTokenizer</span> st <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> cmd<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">hasMoreTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
			<span class="token punctuation">{</span>         
				cmd <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">"/h"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Usage: GetPFans [/h] [/s:yy-mm-dd] [/d:dest-dir]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  Where"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"     /h = Help."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"     /s = Specify start date (in the form yy[-mm[-dd]])"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"     dest-dir = Desitination directory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">continue</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">"/s"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					<span class="token class-name">StringTokenizer</span> st2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>st2<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					startYear <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>st2<span class="token punctuation">.</span><span class="token function">hasMoreTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>st2<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						startMonth <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>st2<span class="token punctuation">.</span><span class="token function">hasMoreTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
						<span class="token punctuation">{</span>
							i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>st2<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							startDay <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">continue</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">"/d"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					outRoot <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">continue</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>			
		<span class="token punctuation">}</span>
		
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Getting PFans Archives starting at "</span> <span class="token operator">+</span> month<span class="token punctuation">[</span>startMonth<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> day<span class="token punctuation">[</span>startDay<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> startYear<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">try</span>
		<span class="token punctuation">{</span>
			<span class="token class-name">String</span> url<span class="token punctuation">;</span>
			<span class="token class-name">String</span> sOutDir<span class="token punctuation">;</span>

			<span class="token keyword">int</span> startMonthTemp <span class="token operator">=</span> startMonth<span class="token punctuation">;</span>
			<span class="token keyword">int</span> startDayTemp <span class="token operator">=</span> startDay<span class="token punctuation">;</span>
			<span class="token keyword">int</span> startYearTemp <span class="token operator">=</span> startYear<span class="token punctuation">;</span>

			<span class="token comment">// For each of the 10 lists</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token comment">// Create directory</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					sOutDir <span class="token operator">=</span> outRoot <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
					sOutDir <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Creating directory: "</span> <span class="token operator">+</span> sOutDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">//File dir = new File(sOutDir);</span>
				<span class="token comment">//dir.mkdirs();</span>

				startYear <span class="token operator">=</span> startYearTemp<span class="token punctuation">;</span>
				startMonth <span class="token operator">=</span> startMonthTemp<span class="token punctuation">;</span>
				startDay <span class="token operator">=</span> startDayTemp<span class="token punctuation">;</span>
				
				<span class="token keyword">boolean</span> fEnd<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
				
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> startYear<span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> endYear <span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> startMonth<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						startMonth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// only use real start value for first year.</span>
						
						<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> startDay<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> d <span class="token operator">&lt;</span> <span class="token number">31</span><span class="token punctuation">;</span> d<span class="token operator">++</span><span class="token punctuation">)</span>
						<span class="token punctuation">{</span>
							startDay <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// only use real start value for first month</span>
							
							<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> endYear <span class="token operator">&amp;&amp;</span> m <span class="token operator">==</span> <span class="token punctuation">(</span>endMonth<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> d <span class="token operator">>=</span> endDay<span class="token punctuation">)</span>
							<span class="token punctuation">{</span>
								fEnd <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
								<span class="token keyword">break</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							
							<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"List="</span> <span class="token operator">+</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token operator">+</span> <span class="token string">", Year="</span> <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token string">", Month="</span> <span class="token operator">+</span> month<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">", Day="</span> <span class="token operator">+</span> day<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							url <span class="token operator">=</span>  baseURL <span class="token operator">+</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"&amp;Month="</span> <span class="token operator">+</span> month<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"&amp;Day="</span> <span class="token operator">+</span> day<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"&amp;Year="</span> <span class="token operator">+</span> y<span class="token punctuation">;</span>

							inStream <span class="token operator">=</span> <span class="token class-name">GetPFans</span><span class="token punctuation">.</span><span class="token class-name">BindToURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
							<span class="token class-name">BufferedReader</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inStream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

							<span class="token keyword">try</span> 
							<span class="token punctuation">{</span>
								<span class="token comment">// look for &lt;pre> or 'no archive"</span>
								s <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">while</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
								<span class="token punctuation">{</span>
									<span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">"&lt;pre>"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
										<span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// Time to go to work!</span>
									<span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">"&lt;h2>Sorry, there is no PorscheFans Archive available for this date.&lt;/h2>"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
									<span class="token punctuation">{</span>
										<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  No archive."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
										s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// abort!</span>
										<span class="token keyword">break</span><span class="token punctuation">;</span>
									<span class="token punctuation">}</span>
									s <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
								
								<span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
								<span class="token punctuation">{</span>
									<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"  No file created."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
									in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
									inStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
									<span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// skip this file</span>
								<span class="token punctuation">}</span>
								
								<span class="token comment">// Create a temporary file</span>
								<span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">"GetPFans~.tmp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								
<span class="token comment">//								out.println("PorscheFans " + list[i] + " list archive");</span>
<span class="token comment">//								out.println("For " + month[m] + "/" + day[d] + "/" + y);</span>
<span class="token comment">//								out.println("---------------------");</span>

								<span class="token comment">// Read/Write to temp file</span>
								s <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">while</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
								<span class="token punctuation">{</span>
									<span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token string">"&lt;/pre>"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// we are done</span>
										<span class="token keyword">break</span><span class="token punctuation">;</span>
									out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
									s <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
								out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								inStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								
								<span class="token class-name">String</span> sDigest <span class="token operator">=</span> y <span class="token operator">+</span> month<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">+</span> day<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"-"</span><span class="token punctuation">;</span>
								<span class="token comment">// Append year to output directory</span>
								<span class="token class-name">String</span> sTmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>sDigest<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>sDigest<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">,</span> sDigest<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>sTmp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> 
									sTmp <span class="token operator">=</span> <span class="token string">"20"</span> <span class="token operator">+</span> sTmp<span class="token punctuation">;</span>
								<span class="token keyword">else</span>
									sTmp <span class="token operator">=</span> <span class="token string">"19"</span> <span class="token operator">+</span> sTmp<span class="token punctuation">;</span>
								sOutDir <span class="token operator">=</span> sOutDir <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> sTmp<span class="token punctuation">;</span>

								<span class="token comment">// Append month to output directory</span>
								sTmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>sDigest<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>sDigest<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">,</span> sDigest<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								sOutDir <span class="token operator">=</span> sOutDir <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> sTmp<span class="token punctuation">;</span>

								<span class="token comment">// Create the directory</span>
								<span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>sOutDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
								f<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								
								<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  Splitting "</span> <span class="token operator">+</span> sDigest <span class="token operator">+</span> <span class="token string">" to "</span> <span class="token operator">+</span> sOutDir <span class="token operator">+</span> <span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								inStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"GetPfans~.tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token class-name">DigestSplitter</span> splitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DigestSplitter</span><span class="token punctuation">(</span>inStream<span class="token punctuation">,</span> sOutDir<span class="token punctuation">,</span> sDigest<span class="token punctuation">)</span><span class="token punctuation">;</span>
								splitter<span class="token punctuation">.</span><span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								inStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								
								<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">".done!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>	
							<span class="token punctuation">{</span>
							    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Exception reading:  "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">return</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span> <span class="token comment">// day</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>fEnd <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token comment">// month</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>fEnd <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token comment">// year</span>
			<span class="token punctuation">}</span> <span class="token comment">// list</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>	
		<span class="token punctuation">{</span>
		    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Exception:  "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
</body></html>
