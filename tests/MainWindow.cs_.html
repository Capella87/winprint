<!DOCTYPE html><html><head><title>C:\Users\ckindel\source\winprint\tests\MainWindow.cs</title>
<meta charset="utf-8"/>
<link href="file:///C:/Users/ckindel/source/node_modules/prismjs/themes/prism-coy.css" rel="stylesheet"/>
<link href="file:/C:/Users/ckindel/source/winprint/proto/winforms/WinPrint/bin/Debug/netcoreapp3.0/prism-winprint-overrides.css" rel="stylesheet"/>
</head><body>
<pre class="language-csharp line-numbers "><code class="language-csharp">
<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Printing<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">;</span>
<span class="token keyword">using</span> WinPrint<span class="token punctuation">.</span>Core<span class="token punctuation">;</span>
<span class="token keyword">using</span> WinPrint<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>Models<span class="token punctuation">;</span>
<span class="token keyword">using</span> WinPrint<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>Services<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> WinPrint <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">MainWindow</span> <span class="token punctuation">:</span> <span class="token class-name">Form</span> <span class="token punctuation">{</span>

        <span class="token comment">// The Windows printer document</span>
        <span class="token keyword">private</span> <span class="token class-name">PrintDocument</span> printDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Winprint Print Preview control</span>
        <span class="token keyword">private</span> <span class="token class-name">PrintPreview</span> printPreview<span class="token punctuation">;</span>

        <span class="token comment">//private string file = "..\..\..\..\..\..\tests\formfeeds.txt";</span>
        <span class="token comment">//private string file = "..\..\..\..\..\..\tests\TEST.TXT";</span>
        <span class="token comment">//private string file = "..\..\..\..\..\..\tests\long html doc as text.TXT";</span>
        <span class="token comment">//private string file = @"C:Usersckindelsourcewinprint	ests	est.html";</span>
        <span class="token keyword">private</span> <span class="token keyword">string</span> file <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">//@"............protowinformsWinPrintViewModelsSheetViewModel.cs";</span>

        <span class="token punctuation">[</span><span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>CodeAnalysis<span class="token punctuation">.</span>SuppressMessage</span><span class="token punctuation">(</span><span class="token string">"Globalization"</span><span class="token punctuation">,</span> <span class="token string">"CA1303:Do not pass literals as localized parameters"</span><span class="token punctuation">,</span> Justification <span class="token operator">=</span> <span class="token string">"&lt;Pending>"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token function">MainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Icon <span class="token operator">=</span> Resources<span class="token punctuation">.</span>printer_and_fax_w<span class="token punctuation">;</span>

            printPreview <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintPreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>Anchor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyButton<span class="token punctuation">.</span>Anchor<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>BackColor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyButton<span class="token punctuation">.</span>BackColor<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyButton<span class="token punctuation">.</span>Location<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>Margin <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyButton<span class="token punctuation">.</span>Margin<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">"printPreview"</span><span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dummyButton<span class="token punctuation">.</span>Size<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>TabIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// this.dummyButton.TabIndex;</span>
            printPreview<span class="token punctuation">.</span>TabStop <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>


            <span class="token keyword">if</span> <span class="token punctuation">(</span>LicenseManager<span class="token punctuation">.</span>UsageMode <span class="token operator">!=</span> LicenseUsageMode<span class="token punctuation">.</span>Designtime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>panelRight<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dummyButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>panelRight<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>printPreview<span class="token punctuation">)</span><span class="token punctuation">;</span>
                printersCB<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
                paperSizesCB<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Flag: Has Dispose already been called?</span>
        <span class="token keyword">bool</span> disposed <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
        <span class="token comment">// Protected implementation of Dispose pattern.</span>
        <span class="token comment">/// &lt;summary></span>
        <span class="token comment">///  Clean up any resources being used.</span>
        <span class="token comment">/// &lt;/summary></span>
        <span class="token comment">/// &lt;param name="disposing">true if managed resources should be disposed; otherwise, false.&lt;/param></span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token keyword">bool</span> disposing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>disposed<span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>disposing <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>components <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                components<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//if (streamToPrint != null) streamToPrint.Dispose();</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>printDoc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> printDoc<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>printPreview <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> printPreview<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            disposed <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span>disposing<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token class-name">SheetViewModel</span> <span class="token function">CreatePreviewSheetViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"CreateSheetViewModel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SheetViewModel</span> svm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SheetViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            svm<span class="token punctuation">.</span><span class="token function">SetSettings</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            landscapeCheckbox<span class="token punctuation">.</span>Checked <span class="token operator">=</span> svm<span class="token punctuation">.</span>Landscape<span class="token punctuation">;</span>
            enableHeader<span class="token punctuation">.</span>Checked <span class="token operator">=</span> svm<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Enabled<span class="token punctuation">;</span>
            headerTextBox<span class="token punctuation">.</span>Text <span class="token operator">=</span> svm<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
            enableFooter<span class="token punctuation">.</span>Checked <span class="token operator">=</span> svm<span class="token punctuation">.</span>Footer<span class="token punctuation">.</span>Enabled<span class="token punctuation">;</span>
            footerTextBox<span class="token punctuation">.</span>Text <span class="token operator">=</span> svm<span class="token punctuation">.</span>Footer<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>

            topMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Top <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
            leftMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Left <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
            rightMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Right <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
            bottomMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Bottom <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>

            pageSeparator<span class="token punctuation">.</span>Checked <span class="token operator">=</span> svm<span class="token punctuation">.</span>PageSepartor<span class="token punctuation">;</span>
            rows<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Rows<span class="token punctuation">;</span>
            columns<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Columns<span class="token punctuation">;</span>
            padding<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Padding <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>

            svm<span class="token punctuation">.</span>PropertyChanged <span class="token operator">+=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"SheetViewModel.PropertyChanged: {e.PropertyName}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>PropertyName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">"Landscape"</span><span class="token punctuation">:</span>
                        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"  Checking checkbox: {ModelLocator.Current.Settings.Sheets.GetValueOrDefault(ModelLocator.Current.Settings.DefaultSheet.ToString()).Landscape}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        landscapeCheckbox<span class="token punctuation">.</span>Checked <span class="token operator">=</span> svm<span class="token punctuation">.</span>Landscape<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"Header"</span><span class="token punctuation">:</span>
                        headerTextBox<span class="token punctuation">.</span>Text <span class="token operator">=</span> svm<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"Footer"</span><span class="token punctuation">:</span>
                        footerTextBox<span class="token punctuation">.</span>Text <span class="token operator">=</span> svm<span class="token punctuation">.</span>Footer<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"Margins"</span><span class="token punctuation">:</span>
                        topMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Top <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
                        leftMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Left <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
                        rightMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Right <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
                        bottomMargin<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span>Bottom <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>

                        <span class="token comment">// Keep PrintDocument updated for WinForms.PrintPreview</span>
                        printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>Margins <span class="token operator">=</span> <span class="token punctuation">(</span>Margins<span class="token punctuation">)</span>svm<span class="token punctuation">.</span>Margins<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"PageSeparator"</span><span class="token punctuation">:</span>
                        pageSeparator<span class="token punctuation">.</span>Checked <span class="token operator">=</span> svm<span class="token punctuation">.</span>PageSepartor<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"Rows"</span><span class="token punctuation">:</span>
                        rows<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Rows<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"Columns"</span><span class="token punctuation">:</span>
                        columns<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Columns<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">"Padding"</span><span class="token punctuation">:</span>
                        padding<span class="token punctuation">.</span>Value <span class="token operator">=</span> svm<span class="token punctuation">.</span>Padding <span class="token operator">/</span> <span class="token number">100</span>M<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            svm<span class="token punctuation">.</span>SettingsChanged <span class="token operator">+=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> reflow<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"SheetViewModel.SettingsChanged: {reflow}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>reflow<span class="token punctuation">)</span>
                    <span class="token function">SheetSettingsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    printPreview<span class="token punctuation">.</span><span class="token function">Invalidate</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            printPreview<span class="token punctuation">.</span>SheetViewModel <span class="token operator">=</span> svm<span class="token punctuation">;</span>

            <span class="token comment">// TODO: Batch Print</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Files <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Files<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Files<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> list <span class="token operator">=</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Files<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                file <span class="token operator">=</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            svm<span class="token punctuation">.</span>File <span class="token operator">=</span> file<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Text <span class="token operator">=</span> $<span class="token string">"WinPrint - {file}"</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> svm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">landscapeCheckbox_CheckedChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"landscapeCheckbox_CheckedChanged: {landscapeCheckbox.Checked}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printersCB<span class="token punctuation">.</span>Enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// TODO: This should find the Preview SheetViewModel instance and set the property on this, not</span>
                <span class="token comment">// the model</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Landscape <span class="token operator">=</span>
                    printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>Landscape <span class="token operator">=</span>
                    landscapeCheckbox<span class="token punctuation">.</span>Checked<span class="token punctuation">;</span>

                <span class="token comment">// We do NOT force settings reflow here; as it will come through with a SettingsChanged from viewmodel</span>
                <span class="token comment">//SheetSettingsChanged();</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">MainWindow_Load</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Cursor <span class="token operator">=</span> Cursors<span class="token punctuation">.</span>WaitCursor<span class="token punctuation">;</span>
            <span class="token comment">// Load settings</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"First reference to ModelLocator.Current.Settings"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> sheets <span class="token operator">=</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">;</span>

            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>PropertyChanged <span class="token operator">+=</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"Settings.PropertyChanged: {e.PropertyName}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>PropertyName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">"DefaultSheet"</span><span class="token punctuation">:</span>
                        comboBoxSheet<span class="token punctuation">.</span>Text <span class="token operator">=</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
                        <span class="token function">ChangeSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            comboBoxSheet<span class="token punctuation">.</span>DisplayMember <span class="token operator">=</span> <span class="token string">"Value"</span><span class="token punctuation">;</span>
            comboBoxSheet<span class="token punctuation">.</span>ValueMember <span class="token operator">=</span> <span class="token string">"Key"</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> s <span class="token keyword">in</span> sheets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                comboBoxSheet<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token generic-method"><span class="token function">KeyValuePair</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Select default printer and paper size</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">string</span> printer <span class="token keyword">in</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Printing<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>InstalledPrinters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                printersCB<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>printer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//printersCB.Text = "OneNote";</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>IsDefaultPrinter<span class="token punctuation">)</span>
                    printersCB<span class="token punctuation">.</span>Text <span class="token operator">=</span> printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrinterName<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrinterName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>printersCB<span class="token punctuation">.</span>SelectedItem<span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">PaperSize</span> ps <span class="token keyword">in</span> printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PaperSizes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                paperSizesCB<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            paperSizesCB<span class="token punctuation">.</span>Text <span class="token operator">=</span> printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>PaperSize<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// We kept these disabled during load</span>
            printersCB<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
            paperSizesCB<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>

            <span class="token comment">// Select default Sheet </span>
            comboBoxSheet<span class="token punctuation">.</span>Text <span class="token operator">=</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Files <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token comment">//&amp;&amp;</span>
                <span class="token comment">//  ModelLocator.Current.Options.Files.Any() &amp;&amp;</span>
                <span class="token comment">//  !string.IsNullOrEmpty(ModelLocator.Current.Options.Files.ToList&lt;string>()[0])) </span>
            <span class="token punctuation">{</span>
                file <span class="token operator">=</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Files<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            printPreview<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Size</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Size<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Size<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Location<span class="token punctuation">.</span>X<span class="token punctuation">,</span> ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Location<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>WindowState <span class="token operator">=</span> <span class="token punctuation">(</span>System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>FormWindowState<span class="token punctuation">)</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>WindowState<span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>Cursor <span class="token operator">=</span> Cursors<span class="token punctuation">.</span>Default<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OpenFileDialog</span> openFileDialog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenFileDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    
                    openFileDialog<span class="token punctuation">.</span>InitialDirectory <span class="token operator">=</span> $<span class="token string">"{Environment.GetFolderPath(Environment.SpecialFolder.UserProfile)}\source\winprint\tests"</span><span class="token punctuation">;</span>
                    openFileDialog<span class="token punctuation">.</span>Filter <span class="token operator">=</span> <span class="token string">"code files (*.c*)|*.c*|txt files (*.txt)|*.txt|All files (*.*)|*.*"</span><span class="token punctuation">;</span>
                    openFileDialog<span class="token punctuation">.</span>FilterIndex <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
                    openFileDialog<span class="token punctuation">.</span>RestoreDirectory <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>openFileDialog<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> DialogResult<span class="token punctuation">.</span>OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        file <span class="token operator">=</span> openFileDialog<span class="token punctuation">.</span>FileNames<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ToList</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Go!</span>
            <span class="token function">ChangeSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ChangeSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Cursor <span class="token operator">=</span> Cursors<span class="token punctuation">.</span>WaitCursor<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>SheetViewModel <span class="token operator">=</span> <span class="token function">CreatePreviewSheetViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Cursor <span class="token operator">=</span> Cursors<span class="token punctuation">.</span>Default<span class="token punctuation">;</span>
            <span class="token function">SheetSettingsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">MainWindow_FormClosing</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">FormClosingEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Save Window state</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>WindowState <span class="token operator">==</span> System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms<span class="token punctuation">.</span>FormWindowState<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>WindowSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Size<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Size<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>WindowLocation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Location<span class="token punctuation">.</span>X<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Location<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>WindowSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RestoreBounds<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RestoreBounds<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>WindowLocation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RestoreBounds<span class="token punctuation">.</span>X<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RestoreBounds<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>WindowState <span class="token operator">=</span> <span class="token punctuation">(</span>Core<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>FormWindowState<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>WindowState<span class="token punctuation">;</span>
            ServiceLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>SettingsService<span class="token punctuation">.</span><span class="token function">SaveSettings</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">internal</span> <span class="token keyword">void</span> <span class="token function">SheetSettingsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SheetSettingsChanged()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>Cursor <span class="token operator">=</span> Cursors<span class="token punctuation">.</span>WaitCursor<span class="token punctuation">;</span>
            <span class="token comment">// Set landscape. This causes other DefaultPageSettings to change</span>
            printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>Landscape <span class="token operator">=</span> landscapeCheckbox<span class="token punctuation">.</span>Checked<span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span>SheetViewModel<span class="token punctuation">.</span><span class="token function">Reflow</span><span class="token punctuation">(</span>printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
            printPreview<span class="token punctuation">.</span><span class="token function">Invalidate</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">SizePreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>Cursor <span class="token operator">=</span> Cursors<span class="token punctuation">.</span>Default<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">internal</span> <span class="token keyword">void</span> <span class="token function">SizePreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"SizePreview()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printPreview <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> printPreview<span class="token punctuation">.</span>SheetViewModel <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token class-name">Size</span> size <span class="token operator">=</span> panelRight<span class="token punctuation">.</span>Size<span class="token punctuation">;</span>
            size<span class="token punctuation">.</span>Height <span class="token operator">-=</span> headerTextBox<span class="token punctuation">.</span>Height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
            size<span class="token punctuation">.</span>Width <span class="token operator">-=</span> headerTextBox<span class="token punctuation">.</span>Height<span class="token punctuation">;</span>

            <span class="token keyword">double</span> w <span class="token operator">=</span> printPreview<span class="token punctuation">.</span>SheetViewModel<span class="token punctuation">.</span>Bounds<span class="token punctuation">.</span>Width<span class="token punctuation">;</span>
            <span class="token keyword">double</span> h <span class="token operator">=</span> printPreview<span class="token punctuation">.</span>SheetViewModel<span class="token punctuation">.</span>Bounds<span class="token punctuation">.</span>Height<span class="token punctuation">;</span>

            <span class="token keyword">var</span> scalingX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>size<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>w<span class="token punctuation">;</span>
            <span class="token keyword">var</span> scalingY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>size<span class="token punctuation">.</span>Height <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>h<span class="token punctuation">;</span>

            <span class="token comment">// Now, we have two scaling ratios, which one produces the smaller image? The one that has the smallest scaling factor.</span>
            <span class="token keyword">var</span> scale <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Min</span><span class="token punctuation">(</span>scalingY<span class="token punctuation">,</span> scalingX<span class="token punctuation">)</span><span class="token punctuation">;</span>

            printPreview<span class="token punctuation">.</span>Size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>w <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>h <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Now center</span>
            printPreview<span class="token punctuation">.</span>Location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">(</span>panelRight<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>printPreview<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>panelRight<span class="token punctuation">.</span>Height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>printPreview<span class="token punctuation">.</span>Height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">MainWindow_Layout</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">LayoutEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// This event is raised once at startup with the AffectedControl</span>
            <span class="token comment">// and AffectedProperty properties on the LayoutEventArgs as null. </span>
            <span class="token comment">// The event provides size preferences for that case.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>AffectedControl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>AffectedProperty <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Ensure that the affected property is the Bounds property</span>
                <span class="token comment">// of the form.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>AffectedProperty<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"Bounds"</span><span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>InvariantCultureIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"MainWindow_Layout bounds changed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">headerTextBox_TextChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Text <span class="token operator">=</span> headerTextBox<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">footerTextBox_TextChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Footer<span class="token punctuation">.</span>Text <span class="token operator">=</span> footerTextBox<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">printersCB_SelectedIndexChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printersCB<span class="token punctuation">.</span>Enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"printersCB_SelectedIndexChanged"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrinterName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>printersCB<span class="token punctuation">.</span>SelectedItem<span class="token punctuation">;</span>
                paperSizesCB<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">PaperSize</span> ps <span class="token keyword">in</span> printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PaperSizes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    paperSizesCB<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                paperSizesCB<span class="token punctuation">.</span>Text <span class="token operator">=</span> printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>PaperSize<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">paperSizesCB_SelectedIndexChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printersCB<span class="token punctuation">.</span>Enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"paperSizesCB_SelectedIndexChanged"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Set the paper size based upon the selection in the combo box.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>paperSizesCB<span class="token punctuation">.</span>SelectedIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>PaperSize <span class="token operator">=</span> printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PaperSizes<span class="token punctuation">[</span>paperSizesCB<span class="token punctuation">.</span>SelectedIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">SheetSettingsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>CodeAnalysis<span class="token punctuation">.</span>SuppressMessage</span><span class="token punctuation">(</span><span class="token string">"Design"</span><span class="token punctuation">,</span> <span class="token string">"CA1031:Do not catch general exception types"</span><span class="token punctuation">,</span> Justification <span class="token operator">=</span> <span class="token string">"&lt;Pending>"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">printButton_Click</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">using</span> <span class="token keyword">var</span> print <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Core<span class="token punctuation">.</span>Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// TODO: It's hokey that Landscape is the only printer setting that's treated specially</span>
            <span class="token comment">// </span>
            print<span class="token punctuation">.</span>PrintDocument<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>Landscape <span class="token operator">=</span> landscapeCheckbox<span class="token punctuation">.</span>Checked<span class="token punctuation">;</span>
            print<span class="token punctuation">.</span>SheetVM<span class="token punctuation">.</span>File <span class="token operator">=</span> file<span class="token punctuation">;</span>
            print<span class="token punctuation">.</span>SheetVM<span class="token punctuation">.</span><span class="token function">SetSettings</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            print<span class="token punctuation">.</span><span class="token function">SetPrinter</span><span class="token punctuation">(</span>printDoc<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrinterName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            print<span class="token punctuation">.</span><span class="token function">SetPaperSize</span><span class="token punctuation">(</span>printDoc<span class="token punctuation">.</span>DefaultPageSettings<span class="token punctuation">.</span>PaperSize<span class="token punctuation">.</span>PaperName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// TODO: Decide how to make showing the print dialog a setting (or if needed at all)</span>
            <span class="token comment">// the only reason I can think of now is from/to page support.</span>
            <span class="token keyword">bool</span> showPrintDialog <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>showPrintDialog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">using</span> <span class="token class-name">PrintDialog</span> printDialog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                printDialog<span class="token punctuation">.</span>AllowSomePages <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
                printDialog<span class="token punctuation">.</span>ShowHelp <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
                <span class="token comment">// printDialog.AllowSelection = true;</span>

                printDialog<span class="token punctuation">.</span>Document <span class="token operator">=</span> print<span class="token punctuation">.</span>PrintDocument<span class="token punctuation">;</span>
                printDialog<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>FromPage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token comment">// Ideally we'd get NumSheets from print.SheetSVM but that would cause a</span>
                <span class="token comment">// un-needed Reflow. So use the printPreview VM.</span>
                printDialog<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>ToPage <span class="token operator">=</span> printPreview<span class="token punctuation">.</span>SheetViewModel<span class="token punctuation">.</span>NumSheets<span class="token punctuation">;</span>
                <span class="token comment">//If the result is OK then print the document.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>printDialog<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> DialogResult<span class="token punctuation">.</span>OK <span class="token operator">&amp;&amp;</span> printDialog<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrintRange <span class="token operator">==</span> PrintRange<span class="token punctuation">.</span>SomePages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    print<span class="token punctuation">.</span>PrintDocument<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrintRange <span class="token operator">=</span> printDialog<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>PrintRange<span class="token punctuation">;</span>
                    print<span class="token punctuation">.</span>PrintDocument<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>FromPage <span class="token operator">=</span> printDialog<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>FromPage<span class="token punctuation">;</span>
                    print<span class="token punctuation">.</span>PrintDocument<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>ToPage <span class="token operator">=</span> printDialog<span class="token punctuation">.</span>PrinterSettings<span class="token punctuation">.</span>ToPage<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            print<span class="token punctuation">.</span><span class="token function">DoPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">panelRight_Resize</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">SizePreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">enableHeader_CheckedChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"enableHeader_CheckedChanged: {enableHeader.Checked}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printersCB<span class="token punctuation">.</span>Enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// TODO: This should find the Preview SheetViewModel instance and set the property on this, not</span>
                <span class="token comment">// the model</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Enabled <span class="token operator">=</span>
                    enableHeader<span class="token punctuation">.</span>Checked<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">enableFooter_CheckedChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"enableFooter_CheckedChanged: {enableFooter.Checked}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printersCB<span class="token punctuation">.</span>Enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// TODO: This should find the Preview SheetViewModel instance and set the property on this, not</span>
                <span class="token comment">// the model</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Footer<span class="token punctuation">.</span>Enabled <span class="token operator">=</span>
                    enableFooter<span class="token punctuation">.</span>Checked<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">comboBoxSheet_SelectedIndexChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            KeyValuePair<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">></span> si <span class="token operator">=</span> <span class="token punctuation">(</span>KeyValuePair<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">></span><span class="token punctuation">)</span>comboBoxSheet<span class="token punctuation">.</span>SelectedItem<span class="token punctuation">;</span>
            Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"comboBoxSheet_SelectedIndexChanged: {si.Key}, {si.Value}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>printersCB<span class="token punctuation">.</span>Enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>si<span class="token punctuation">.</span>Key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//ChangeSheet(ModelLocator.Current.Settings.Sheets[si.Key]);</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">topMargin_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Margins</span> margins <span class="token operator">=</span> <span class="token punctuation">(</span>Margins<span class="token punctuation">)</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            margins<span class="token punctuation">.</span>Top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>topMargin<span class="token punctuation">.</span>Value <span class="token operator">*</span> <span class="token number">100</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins <span class="token operator">=</span> margins<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">leftMargin_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Margins</span> margins <span class="token operator">=</span> <span class="token punctuation">(</span>Margins<span class="token punctuation">)</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            margins<span class="token punctuation">.</span>Left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>leftMargin<span class="token punctuation">.</span>Value <span class="token operator">*</span> <span class="token number">100</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins <span class="token operator">=</span> margins<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rightMargin_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Margins</span> margins <span class="token operator">=</span> <span class="token punctuation">(</span>Margins<span class="token punctuation">)</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            margins<span class="token punctuation">.</span>Right <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>rightMargin<span class="token punctuation">.</span>Value <span class="token operator">*</span> <span class="token number">100</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins <span class="token operator">=</span> margins<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">bottomMargin_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Margins</span> margins <span class="token operator">=</span> <span class="token punctuation">(</span>Margins<span class="token punctuation">)</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            margins<span class="token punctuation">.</span>Bottom <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>bottomMargin<span class="token punctuation">.</span>Value <span class="token operator">*</span> <span class="token number">100</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Margins <span class="token operator">=</span> margins<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pageSeparator_CheckedChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>PageSeparator <span class="token operator">=</span> pageSeparator<span class="token punctuation">.</span>Checked<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rows_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Rows <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>rows<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">columns_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Columns <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>columns<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">padding_ValueChanged</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span><span class="token function">GetValueOrDefault</span><span class="token punctuation">(</span>ModelLocator<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Settings<span class="token punctuation">.</span>DefaultSheet<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Padding <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>padding<span class="token punctuation">.</span>Value <span class="token operator">*</span> <span class="token number">100</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
</body></html>
